<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ GOLDSMITH</title>
    <style>
        * { 
            background: #000 !important; 
            color: #FFD700 !important; 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Times New Roman', serif !important;
        }
        
        body { 
            padding: 15px; 
            max-width: 1400px; 
            margin: 0 auto; 
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
        }
        
        h1 { 
            text-align: center; 
            border-bottom: 2px solid #DAA520; 
            padding-bottom: 5px; 
            margin: 0 0 10px 0; 
            font-size: 2em; 
            flex-shrink: 0;
        }
        
        h1::before { content: "üí∞ "; }
        
        /* TOP CONTROLS - FIXED */
        .top-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            flex-shrink: 0;
        }
        
        button {
            background: #000 !important;
            border: 1px solid #DAA520;
            color: #FFD700 !important;
            padding: 6px 12px;
            cursor: pointer;
            font-family: 'Times New Roman', serif;
            font-size: 13px;
            border-radius: 3px;
        }
        
        button:hover {
            background: #222 !important;
        }
        
        /* TOOL PANELS */
        .tool-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            height: 120px;
            flex-shrink: 0;
        }
        
        @media (max-width: 900px) {
            .tool-panels {
                grid-template-columns: 1fr;
                height: 240px;
            }
        }
        
        .tool-box {
            border: 1px solid #DAA520;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .tool-box h3 {
            margin: 0 0 8px 0;
            font-size: 1em;
            text-align: center;
            color: #DAA520;
        }
        
        .tool-content {
            flex: 1;
            overflow: auto;
            font-size: 12px;
            line-height: 1.3;
        }
        
        /* MAIN EDITOR PANELS - FIXED HEIGHT, SCROLLABLE */
        .editor-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            height: 280px; /* FIXED HEIGHT */
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        
        @media (max-width: 900px) {
            .editor-panels {
                grid-template-columns: 1fr;
                height: 560px;
            }
        }
        
        .panel {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .panel h2 {
            margin: 0 0 8px 0;
            font-size: 1.1em;
            text-align: center;
            color: #DAA520;
            flex-shrink: 0;
        }
        
        textarea, .output-box {
            flex: 1;
            background: #111 !important;
            border: 1px solid #DAA520;
            padding: 10px;
            font-size: 13px;
            line-height: 1.4;
            font-family: 'Monaco', 'Menlo', monospace;
            white-space: pre-wrap;
            overflow: auto; /* SCROLLABLE */
            resize: none;
            width: 100%;
            color: #FFD700 !important;
            min-height: 0;
            box-sizing: border-box;
        }
        
        .output-box {
            cursor: text;
            user-select: text;
        }
        
        /* PREVIEW AREA - AT BOTTOM, FLEXIBLE */
        .preview-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 400px;
            border-top: 2px solid #DAA520;
            margin-top: 10px;
            padding-top: 15px;
        }
        
        .preview-header {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #DAA520;
        }
        
        .preview-frame {
            flex: 1;
            border: 1px solid #DAA520;
            background: #000 !important;
            overflow: auto;
        }
        
        .preview-content {
            padding: 30px;
            min-height: 100%;
            background: #000 !important;
        }
        
        /* FOOTER */
        .footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #333;
            font-size: 11px;
            text-align: center;
            color: #DAA520;
            line-height: 1.3;
            flex-shrink: 0;
        }
        
        /* SCROLLBAR STYLING */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #111;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #DAA520;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #FFD700;
        }
        
        /* LABEL STYLING */
        .label-tag {
            display: inline-block;
            background: #222;
            padding: 2px 6px;
            margin: 2px;
            border-radius: 3px;
            font-size: 11px;
        }
        
        /* LINK FIREWALL SETTINGS */
        .link-settings {
            border: 1px solid #DAA520;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        .link-settings h3 {
            margin: 0 0 8px 0;
            text-align: center;
            color: #DAA520;
        }
        
        .link-settings textarea {
            width: 100%;
            height: 60px;
            background: #111;
            border: 1px solid #DAA520;
            color: #FFD700;
            padding: 5px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>GOLDSMITH</h1>
    
    <!-- TOP CONTROLS -->
    <div class="top-controls">
        <button onclick="copyOutput()">üìã COPY HTML</button>
        <button onclick="downloadHTML()">üíæ DOWNLOAD HTML</button>
        <button onclick="testOutput()">üëÅÔ∏è PREVIEW</button>
        <button onclick="allCaps()">üî† ALL CAPS</button>
        <button onclick="generateLabels()">üè∑Ô∏è GENERATE LABELS</button>
        <button onclick="clearAll()">üóëÔ∏è CLEAR</button>
        <button onclick="loadExample()">üìñ EXAMPLE</button>
    </div>
    
    <!-- LINK FIREWALL SETTINGS -->
    <div class="link-settings">
        <h3>üîó LINK FIREWALL (Optional)</h3>
        <div style="text-align: center; margin-bottom: 8px; font-size: 11px; color: #DAA520;">
            Add domain extensions to exclude from auto-linking (comma-separated)
        </div>
        <textarea id="linkExclude" placeholder="feed.atom, feed.xml, atom.xml, feed.rss, rss.xml, .atom, .xml, .rss">feed.atom, feed.xml, atom.xml, feed.rss, rss.xml, .atom, .xml, .rss</textarea>
        <div style="text-align: center; margin-top: 5px; font-size: 10px; color: #DAA520;">
            Example: "feed.atom" will NOT become a clickable link
        </div>
    </div>
    
    <!-- TOOL PANELS -->
    <div class="tool-panels">
        <div class="tool-box">
            <h3>üî† ALL CAPS OUTPUT</h3>
            <div class="tool-content" id="allCapsOutput"></div>
        </div>
        <div class="tool-box">
            <h3>üè∑Ô∏è SUGGESTED LABELS</h3>
            <div class="tool-content" id="labelOutput"></div>
        </div>
    </div>
    
    <!-- EDITOR PANELS - FIXED HEIGHT, SCROLLABLE -->
    <div class="editor-panels">
        <div class="panel">
            <h2>üìù INPUT (Paste any text)</h2>
            <textarea id="input" placeholder="Paste anything... First lines without breaks become the stamp. Emojis supported! üèÜ‚ú®"></textarea>
        </div>
        
        <div class="panel">
            <h2>‚ö° OUTPUT (Republicka HTML)</h2>
            <div class="output-box" id="output" onclick="this.select()"></div>
        </div>
    </div>
    
    <!-- PREVIEW SECTION - AT BOTTOM -->
    <div class="preview-section">
        <div class="preview-header">LIVE PREVIEW</div>
        <div class="preview-frame">
            <div class="preview-content" id="preview"></div>
        </div>
    </div>
    
    <!-- FOOTER -->
    <div class="footer">
        üí∞ GOLDSMITH v3.2 | Universal Republicka Formatter | CC0 PUBLICK√Å DOM√ÅNIA | ALL LOVE RESERVED. 
    </div>

    <script>
        // Initialize with example
        loadExample();
        
        // Auto-select output when clicked
        document.getElementById('output').addEventListener('click', function() {
            this.select();
        });
        
        // Auto-convert on input with debounce
        let debounceTimer;
        document.getElementById('input').addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(convertToRepublicka, 500);
        });
        
        // Also convert when link firewall settings change
        document.getElementById('linkExclude').addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(convertToRepublicka, 500);
        });
        
        function convertToRepublicka() {
            let input = document.getElementById('input').value;
            
            // 1. Remove leading empty lines (fixes Blogger copy/paste issue)
            input = input.replace(/^\s*\n/, '');
            
            const lines = input.split('\n');
            
            // Extract stamp lines (first consecutive non-empty lines)
            let stampLines = [];
            let contentStart = 0;
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].trim() === '') {
                    contentStart = i + 1;
                    break;
                }
                if (lines[i].trim().length > 0) {
                    stampLines.push(lines[i].trim());
                }
            }
            
            // Get content
            let content = lines.slice(contentStart).join('\n');
            
            // Generate stamp with decorations - PERFECTED SIZING
            let stampHTML = '';
            if (stampLines.length > 0) {
                const title = stampLines[0];
                const subtitles = stampLines.slice(1);
                
                // PERFECTED DECORATION - fits in one line
                const decoration = '‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª‡º∫‡ºª';
                
                stampHTML = `
<div align="center" style="padding:15px 0;margin-bottom:30px;border-bottom:2px solid #DAA520;">
<div style="color:#DAA520;letter-spacing:1.5px;font-size:0.95em;margin:3px 0;white-space:nowrap;overflow:hidden;">${decoration}</div>
<h1 style="font-size:2.2em;margin:8px 0 4px 0;letter-spacing:6px;text-transform:uppercase;font-weight:bold;line-height:1.2;">
${escapeHtml(title)}
</h1>`;
                
                if (subtitles.length > 0) {
                    stampHTML += subtitles.map((sub, index) => {
                        const size = 1.4 - (index * 0.1);
                        return `<div style="font-size:${size}em;color:#DAA520;margin:${index === 0 ? '10px' : '5px'} 0;letter-spacing:2px;line-height:1.1;">
${escapeHtml(sub)}
</div>`;
                    }).join('');
                }
                
                stampHTML += `
<div style="color:#DAA520;letter-spacing:1.5px;font-size:0.95em;margin:10px 0 3px 0;white-space:nowrap;overflow:hidden;">${decoration}</div>
</div>`;
            }
            
            // Process content - NEW APPROACH: Simple and Blogger-compatible
            // Split content by double newlines to preserve paragraphs
            let paragraphs = content.split(/\n\s*\n/);
            let contentHTML = '';
            
            for (let i = 0; i < paragraphs.length; i++) {
                let para = paragraphs[i];
                
                if (para.trim() === '') {
                    // Blank line - add spacing
                    contentHTML += '<div style="height:1.5em;"></div>\n';
                    continue;
                }
                
                // Process this paragraph line by line
                let linesInPara = para.split('\n');
                let processedLines = [];
                
                for (let line of linesInPara) {
                    line = line.trim();
                    if (line === '') continue;
                    
                    let processedLine = line;
                    
                    // Convert **bold** to <b> (Blogger-compatible)
                    processedLine = processedLine.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                    
                    // Convert *italic* to <i> (Blogger-compatible)
                    processedLine = processedLine.replace(/\*(.*?)\*/g, '<i>$1</i>');
                    
                    // Convert _italic_ to <i>
                    processedLine = processedLine.replace(/_(.*?)_/g, '<i>$1</i>');
                    
                    // Escape HTML
                    processedLine = escapeHtml(processedLine);
                    
                    // Convert existing escaped tags back
                    processedLine = processedLine.replace(/&lt;b&gt;/g, '<b>')
                                                .replace(/&lt;\/b&gt;/g, '</b>')
                                                .replace(/&lt;i&gt;/g, '<i>')
                                                .replace(/&lt;\/i&gt;/g, '</i>');
                    
                    // Get exclude list from firewall
                    const excludeText = document.getElementById('linkExclude').value;
                    const excludeList = excludeText.split(',').map(item => item.trim().toLowerCase()).filter(item => item);
                    
                    // Function to check if link should be excluded
                    function shouldExcludeLink(domain) {
                        const domainLower = domain.toLowerCase();
                        return excludeList.some(excluded => {
                            if (excluded.startsWith('.')) {
                                return domainLower.endsWith(excluded);
                            } else {
                                return domainLower === excluded;
                            }
                        });
                    }
                    
                    // Convert http/https links - with space preservation
                    processedLine = processedLine.replace(/(https?:\/\/[^\s]+)/g, 
                        function(match) {
                            let domain = match.replace(/https?:\/\//, '').split('/')[0];
                            if (shouldExcludeLink(domain)) return match;
                            return '<a href="' + match + '" style="color:#FFFFFF;text-decoration:none;border-bottom:1px solid #DAA520;">' + match + '</a>';
                        });
                    
                    // Convert www. links
                    processedLine = processedLine.replace(/(^|\s)(www\.[a-zA-Z0-9-]+\.[a-zA-Z]{2,})($|\s)/g, 
                        function(match, before, domain, after) {
                            if (shouldExcludeLink(domain)) return match;
                            return before + '<a href="https://' + domain + '" style="color:#FFFFFF;text-decoration:none;border-bottom:1px solid #DAA520;">' + domain + '</a>' + after;
                        });
                    
                    // Convert plain domains (republicka.life, trepublic.net, etc.)
                    processedLine = processedLine.replace(/(^|\s)([a-zA-Z0-9-]+\.[a-zA-Z]{2,})($|\s)/g, 
                        function(match, before, domain, after) {
                            // Skip if it looks like an email or common false positives
                            if (domain.includes('@') || shouldExcludeLink(domain)) {
                                return match;
                            }
                            return before + '<a href="https://' + domain + '" style="color:#FFFFFF;text-decoration:none;border-bottom:1px solid #DAA520;">' + domain + '</a>' + after;
                        });
                    
                    processedLines.push(processedLine);
                }
                
                // Join lines with <br>
                let processedPara = processedLines.join('<br>');
                
                // Check if this is a heading (starts and ends with **)
                const trimmedPara = para.trim();
                if (trimmedPara.startsWith('**') && trimmedPara.endsWith('**') && trimmedPara.length < 100) {
                    // Extract heading text without **
                    const headingText = trimmedPara.substring(2, trimmedPara.length - 2);
                    contentHTML += `<div align="center" style="margin:25px 0;">
<h2 style="font-size:1.5em;font-weight:bold;color:#DAA520;margin:20px 0 10px 0;">${escapeHtml(headingText)}</h2>
</div>\n`;
                } else {
                    // Regular paragraph
                    contentHTML += `<div align="center" style="margin:25px 0;line-height:1.8;font-size:1.2em;max-width:800px;margin-left:auto;margin-right:auto;">
${processedPara}
</div>\n`;
                }
            }
            
            // Add footer
            contentHTML += `
<div style="margin-top:60px;padding-top:20px;border-top:1px solid #333;">
<div align="center">
<div style="font-size:0.9em;color:#DAA520;margin:10px 0;">
CC0 PUBLICK√Å DOM√ÅNIA<br>
ALL LOVE RESERVED.
</div>
</div>
</div>`;
            
            // Build complete HTML - SIMPLE AND BLOGGER-COMPATIBLE
            const html = `<div style="background:#000;color:#FFD700;font-family:'Times New Roman',serif;">
<div style="padding:30px 20px;">
${stampHTML}
<div style="margin-top:25px;">
${contentHTML}
</div>
</div>
</div>`;
            
            // Display output
            document.getElementById('output').textContent = html;
            
            // Update preview
            document.getElementById('preview').innerHTML = html;
        }
        
        function allCaps() {
            const input = document.getElementById('input').value;
            if (!input.trim()) {
                alert('No text to convert! Paste text first.');
                return;
            }
            
            const allCapsText = input.toUpperCase();
            document.getElementById('allCapsOutput').textContent = allCapsText;
            
            navigator.clipboard.writeText(allCapsText).then(() => {
                const capsButton = document.querySelector('button[onclick="allCaps()"]');
                const originalText = capsButton.textContent;
                capsButton.textContent = 'üî† COPIED!';
                setTimeout(() => {
                    capsButton.textContent = originalText;
                }, 1000);
            });
        }
        
        function generateLabels() {
            const input = document.getElementById('input').value;
            if (!input.trim()) {
                alert('No text to analyze! Paste text first.');
                return;
            }
            
            let text = input.toLowerCase();
            
            const stopWords = ['the', 'and', 'for', 'that', 'with', 'this', 'from', 'have', 'what', 'when', 
                              'where', 'why', 'how', 'which', 'who', 'whom', 'their', 'there', 'they', 'them',
                              'then', 'than', 'these', 'those', 'your', 'you', 'our', 'are', 'was', 'were'];
            
            text = text.replace(/[^\w\s]/g, ' ');
            const words = text.split(/\s+/).filter(word => 
                word.length > 3 && 
                !stopWords.includes(word) &&
                !/\d/.test(word)
            );
            
            const wordCount = {};
            words.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });
            
            const sortedWords = Object.keys(wordCount).sort((a, b) => wordCount[b] - wordCount[a]);
            
            const topWords = sortedWords.slice(0, 20);
            let labels = topWords.join(',');
            
            if (labels.length > 200) {
                labels = labels.substring(0, 200);
                const lastComma = labels.lastIndexOf(',');
                if (lastComma > 0) {
                    labels = labels.substring(0, lastComma);
                }
            }
            
            document.getElementById('labelOutput').innerHTML = 
                `<div style="margin-bottom:5px;">${labels}</div>` +
                `<div style="font-size:10px;color:#DAA520;">${labels.length} characters (max 200)</div>`;
            
            navigator.clipboard.writeText(labels).then(() => {
                const labelButton = document.querySelector('button[onclick="generateLabels()"]');
                const originalText = labelButton.textContent;
                labelButton.textContent = 'üè∑Ô∏è COPIED!';
                setTimeout(() => {
                    labelButton.textContent = originalText;
                }, 1000);
            });
        }
        
        function copyOutput() {
            const output = document.getElementById('output').textContent;
            if (!output.trim()) {
                alert('No text to copy! Paste text first.');
                return;
            }
            
            navigator.clipboard.writeText(output).then(() => {
                alert(`Republicka HTML copied! üìã\n\n=== BLOGGER INSTRUCTIONS ===\n1. Open Blogger post editor\n2. Click "HTML" button (top-left)\n3. Delete ALL existing content\n4. Paste this HTML\n5. Click "Publish" immediately\n\nIMPORTANT: If you see "Your HTML content is invalid..."\nCLICK: "Switch" (NOT "Cancel")\nThen publish immediately without editing.`);
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = output;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Republicka HTML copied!');
            });
        }
        
        function downloadHTML() {
            const html = document.getElementById('output').textContent;
            if (!html.trim()) {
                alert('Nothing to download! Paste text first.');
                return;
            }
            
            let title = 'republicka_document';
            const titleMatch = html.match(/<h1[^>]*>(.*?)<\/h1>/);
            if (titleMatch && titleMatch[1]) {
                title = titleMatch[1].substring(0, 50).replace(/[^a-z0-9]/gi, '_');
            }
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function testOutput() {
            const html = document.getElementById('output').textContent;
            if (!html.trim()) {
                alert('Nothing to preview! Paste text first.');
                return;
            }
            
            const newWindow = window.open();
            newWindow.document.write(html);
            newWindow.document.close();
        }
        
        function clearAll() {
            if (confirm('Clear all text?')) {
                document.getElementById('input').value = '';
                document.getElementById('output').textContent = '';
                document.getElementById('preview').innerHTML = '';
                document.getElementById('allCapsOutput').textContent = '';
                document.getElementById('labelOutput').textContent = '';
                document.getElementById('linkExclude').value = 'feed.atom, feed.xml, atom.xml, feed.rss, rss.xml, .atom, .xml, .rss';
            }
        }
        
        function loadExample() {
            const example = `üèõÔ∏è THE LIBRARY OF ALEXANDRIA
‚ú® January 1, 2026 | Year 0002 MC
üìú Emergent Philosophy

**SECTION 1: INTRODUCTION**

Welcome to the eternal library! Each scroll here is a universe contained in text. üèÜ

The ink never fades. The gold never tarnishes. The black background is the void from which all creation emerges. ‚ú®

Check out these amazing Republicka sites:
republicka.life üèõÔ∏è
trepublic.net üìú
community.republicka.life üë•
https://example.com üîó

**SECTION 2: FORMATTING**

*This is italic text* and **this is bold text**.

Each paragraph stands alone, centered in the infinite darkness. ‚ö´

The formatting is absolute. The style is law. ‚öñÔ∏è

Multiple paragraphs are maintained perfectly! üìñ

Emojis work beautifully: üèÜ‚ú®‚ö°üî•üíéüìú‚ö´‚öñÔ∏èüëë

**SECTION 3: CONCLUSION**

Visit our community at community.republicka.life for discussions.

This is the end of the document.`;

            document.getElementById('input').value = example;
            convertToRepublicka();
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Initial conversion
        convertToRepublicka();
    </script>
</body>
</html>
